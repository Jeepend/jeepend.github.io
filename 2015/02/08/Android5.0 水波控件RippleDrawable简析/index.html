<!DOCTYPE html>
<html>
    <head>
    <!-- Title -->
    
    <title>
        Android5.0 水波控件RippleDrawable简析 | Jeepend&#39;s blog
    </title>
    
    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">
    
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Jeepend">
    <meta name="description" content="null">
    <meta name="keywords" content="null">
    
    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Jeepend&#39;s blog">
    
    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Android5.0 水波控件RippleDrawable简析 | Jeepend&#39;s blog">
    <meta property="og:description" content="null">
    
     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">
        
        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->
    
    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

    <style>
        body{
            background-color: #F5F5F5
        }
		
		/* blog_info bottom background */
        #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
            background-color: #fff;
        }
    </style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>
	
	<link rel="stylesheet" href="/css/highlight/solarized-white.css">
	
	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   //alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>
    
    <!-- Custom Head -->
    
</head>
	
	

    <body id="scheme-Paradox">

		
        <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
				
			
			
            <!-- Main Container -->
            <main class="material-layout__content" id="main">
				
                <!-- Top Anchor -->
                <div id="top"></div>
				
				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				
				
                <!-- Post TOC -->

    
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Step-1："><span class="post-toc-number">1.</span> <span class="post-toc-text">Step 1：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Step-2："><span class="post-toc-number">2.</span> <span class="post-toc-text">Step 2：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Step-3："><span class="post-toc-number">3.</span> <span class="post-toc-text">Step 3：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Step-4："><span class="post-toc-number">4.</span> <span class="post-toc-text">Step 4：</span></a></li></ol>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>



<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">
		
        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 5 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            Android5.0 水波控件RippleDrawable简析
        </p>
    </div>

	

				
				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
    
    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Jeepend</strong>
        <span>2月 08, 2015</span>
    </div>
    
    <div class="section-spacer"></div>
	
    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->
    
    <!-- Tags (bookmark) -->
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        
    </ul>
    
    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    
    
    
    
    <!-- Share Twitter -->
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Android5.0 水波控件RippleDrawable简析&url=http://yoursite.com//2015/02/08/Android5.0 水波控件RippleDrawable简析/index.html&via=Jeepend" target="_blank">
        <li class="mdl-menu__item">
            分享到 Twitter
        </li>
    </a>
    
    <!-- Share Google+ -->
    <a class="post_share-link" href="https://plus.google.com/share?url=http://yoursite.com//2015/02/08/Android5.0 水波控件RippleDrawable简析/index.html" target="_blank">
        <li class="mdl-menu__item">
            分享到 Google+
        </li>
    </a>
    
    <!-- Share Weibo -->
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Android5.0 水波控件RippleDrawable简析&url=http://yoursite.com//2015/02/08/Android5.0 水波控件RippleDrawable简析/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            分享到微博
        </li>
    </a>
</ul>
</div>
				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<p>在Android5.0中新增了一种水波效果控件，叫RippleDrawable，当控件使用RippleDrawable作为背景（android:background）且在控件可以接受点击动作（android:clickable=”true”）的条件下，当按下或抬起手指时，会出现水波效果。效果如下图所示：<br><img src="http://img.blog.csdn.net/20150208211926404?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHRqampwZg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="ripple效果展示"><br>以上图片的layout代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:background=&quot;@drawable/ripple_bg&quot;</div><div class="line">    android:clickable=&quot;true&quot; &gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;@string/hello_world&quot; /&gt;</div><div class="line"></div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure>
<p>ripple_bg.xml 内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;ripple xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:color=&quot;#ffff0000&quot; &gt;</div><div class="line"></div><div class="line">&lt;/ripple&gt;</div></pre></td></tr></table></figure>
<p>以上的代码需要sdk版本为21的Eclipse或者Android Studio中编辑，并在Android5.0的虚拟机或真机上运行。<br>以下从源码的角度分析一下RippleDrawable的逻辑：<br>如下面的的时序图，以下将从4步简介按下时的效果：<br><img src="http://img.blog.csdn.net/20150208225735042?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHRqampwZg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Ripple时序图"></p>
<h2 id="Step-1："><a href="#Step-1：" class="headerlink" title="Step 1："></a>Step 1：</h2><p>RippleDrawable::onStateChange()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected boolean onStateChange(int[] stateSet) &#123;</div><div class="line">    final boolean changed = super.onStateChange(stateSet);</div><div class="line"></div><div class="line">    boolean enabled = false;</div><div class="line">    boolean pressed = false;</div><div class="line">    boolean focused = false;</div><div class="line"></div><div class="line">    for (int state : stateSet) &#123;</div><div class="line">        if (state == R.attr.state_enabled) &#123;</div><div class="line">            enabled = true;</div><div class="line">        &#125;</div><div class="line">        if (state == R.attr.state_focused) &#123;</div><div class="line">            focused = true;</div><div class="line">        &#125;</div><div class="line">        if (state == R.attr.state_pressed) &#123;</div><div class="line">            pressed = true;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    setRippleActive(enabled &amp;&amp; pressed);</div><div class="line">    setBackgroundActive(focused || (enabled &amp;&amp; pressed));</div><div class="line"></div><div class="line">    return changed;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上代码中，又调用了setRippleActive()方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">private void setRippleActive(boolean active) &#123;</div><div class="line">    if (mRippleActive != active) &#123;</div><div class="line">        mRippleActive = active;</div><div class="line">        if (active) &#123;</div><div class="line">            tryRippleEnter();</div><div class="line">        &#125; else &#123;</div><div class="line">            tryRippleExit();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而在setRippleActive()中﻿，又调用了tryRippleEnter()方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Attempts to start an enter animation for the active hotspot. Fails if</div><div class="line"> * there are too many animating ripples.</div><div class="line"> */</div><div class="line">private void tryRippleEnter() &#123;</div><div class="line">    if (mExitingRipplesCount &gt;= MAX_RIPPLES) &#123;</div><div class="line">        // This should never happen unless the user is tapping like a maniac</div><div class="line">        // or there is a bug that&apos;s preventing ripples from being removed.</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (mRipple == null) &#123;</div><div class="line">        final float x;</div><div class="line">        final float y;</div><div class="line">        if (mHasPending) &#123;</div><div class="line">            mHasPending = false;</div><div class="line">            x = mPendingX;</div><div class="line">            y = mPendingY;</div><div class="line">        &#125; else &#123;</div><div class="line">            x = mHotspotBounds.exactCenterX();</div><div class="line">            y = mHotspotBounds.exactCenterY();</div><div class="line">        &#125;</div><div class="line">        mRipple = new Ripple(this, mHotspotBounds, x, y);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    final int color = mState.mColor.getColorForState(getState(), Color.TRANSPARENT);</div><div class="line">    mRipple.setup(mState.mMaxRadius, color, mDensity);</div><div class="line">    mRipple.enter();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Step-2："><a href="#Step-2：" class="headerlink" title="Step 2："></a>Step 2：</h2><p>在tryRippleEnter中，首先调用Ripple的setup方法，主要是传入最大半径（maxRadius），水波的颜色（color）和屏幕密度（density），并初始化水波的圆心半径等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public void setup(int maxRadius, int color, float density) &#123;</div><div class="line">    mColorOpaque = color | 0xFF000000;</div><div class="line"></div><div class="line">    if (maxRadius != RippleDrawable.RADIUS_AUTO) &#123;</div><div class="line">        mHasMaxRadius = true;</div><div class="line">        mOuterRadius = maxRadius;</div><div class="line">    &#125; else &#123;</div><div class="line">        final float halfWidth = mBounds.width() / 2.0f;</div><div class="line">        final float halfHeight = mBounds.height() / 2.0f;</div><div class="line">        mOuterRadius = (float) Math.sqrt(halfWidth * halfWidth + halfHeight * halfHeight);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    mOuterX = 0;</div><div class="line">    mOuterY = 0;</div><div class="line">    mDensity = density;</div><div class="line"></div><div class="line">    clampStartingPosition();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接着才开始真正的动画逻辑：<br>Ripple::enter()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Starts the enter animation.</div><div class="line"> */</div><div class="line">public void enter() &#123;</div><div class="line">    cancel();</div><div class="line"></div><div class="line">    final int radiusDuration = (int)</div><div class="line">            (1000 * Math.sqrt(mOuterRadius / WAVE_TOUCH_DOWN_ACCELERATION * mDensity) + 0.5);</div><div class="line"></div><div class="line">    final ObjectAnimator radius = ObjectAnimator.ofFloat(this, &quot;radiusGravity&quot;, 1);</div><div class="line">    radius.setAutoCancel(true);</div><div class="line">    radius.setDuration(radiusDuration);</div><div class="line">    radius.setInterpolator(LINEAR_INTERPOLATOR);</div><div class="line">    radius.setStartDelay(RIPPLE_ENTER_DELAY);</div><div class="line"></div><div class="line">    final ObjectAnimator cX = ObjectAnimator.ofFloat(this, &quot;xGravity&quot;, 1);</div><div class="line">    cX.setAutoCancel(true);</div><div class="line">    cX.setDuration(radiusDuration);</div><div class="line">    cX.setInterpolator(LINEAR_INTERPOLATOR);</div><div class="line">    cX.setStartDelay(RIPPLE_ENTER_DELAY);</div><div class="line"></div><div class="line">    final ObjectAnimator cY = ObjectAnimator.ofFloat(this, &quot;yGravity&quot;, 1);</div><div class="line">    cY.setAutoCancel(true);</div><div class="line">    cY.setDuration(radiusDuration);</div><div class="line">    cY.setInterpolator(LINEAR_INTERPOLATOR);</div><div class="line">    cY.setStartDelay(RIPPLE_ENTER_DELAY);</div><div class="line"></div><div class="line">    mAnimRadius = radius;</div><div class="line">    mAnimX = cX;</div><div class="line">    mAnimY = cY;</div><div class="line"></div><div class="line">    // Enter animations always run on the UI thread, since it&apos;s unlikely</div><div class="line">    // that anything interesting is happening until the user lifts their</div><div class="line">    // finger.</div><div class="line">    radius.start();</div><div class="line">    cX.start();</div><div class="line">    cY.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在上面的代码中，主要是实例化了三个ObjectAnimator，然后分别给它们设置时长（setDuration()），动画变化速率（setInterpolator()）和开始延时（setStartDelay()）,最后调用start()函数使得动画开始。</p>
<h2 id="Step-3："><a href="#Step-3：" class="headerlink" title="Step 3："></a>Step 3：</h2><p>那么，什么是ObjectAnimator呢？简单说就是在规定时间内，按照指定的动画变化速率调用指定类的对应的setter方法（setter方法就是以set开头，并将传入的属性名首字母大写后拼接而成的函数），从而实现让类的成员变量渐变的效果。<br>比如ObjectAnimator.ofFloat(this, “radiusGravity”, 1);这个ObjectAnimator，就是调用当前类（Ripple.java）的setRadiusGravity方法，并传入由0到1的参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@SuppressWarnings(&quot;unused&quot;)</div><div class="line">public void setRadiusGravity(float r) &#123;</div><div class="line">    mTweenRadius = r;</div><div class="line">    invalidateSelf();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里为什么是0到1呢？这是因为，ObjectAnimator其实还会调用getter方法，也就是getRadiusGravity方法获取到初始值，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@SuppressWarnings(&quot;unused&quot;)</div><div class="line">public float getRadiusGravity() &#123;</div><div class="line">    return mTweenRadius;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这个类中，mTweenRadius的初始值就是0：private float mTweenRadius = 0;<br>因此说是由0到1的渐变。<br>而传入的动画变化速率是LINEAR_INTERPOLATOR，这是一个线性变化的速率，因此当按下时，水波是匀速散开的。</p>
<h2 id="Step-4："><a href="#Step-4：" class="headerlink" title="Step 4："></a>Step 4：</h2><p>最后一部是水波的绘制，在Step3的setRadiusGravity()方法中可以看到，每次修改完成员变量的值之后，都会调用invalidateSelf()方法，这个方法其实就是通知系统，可以开始绘制了，最终是会调用到Ripple:draw()：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Draws the ripple centered at (0,0) using the specified paint.</div><div class="line"> */</div><div class="line">public boolean draw(Canvas c, Paint p) &#123;</div><div class="line">    final boolean canUseHardware = c.isHardwareAccelerated();</div><div class="line">    if (mCanUseHardware != canUseHardware &amp;&amp; mCanUseHardware) &#123;</div><div class="line">        // We&apos;ve switched from hardware to non-hardware mode. Panic.</div><div class="line">        cancelHardwareAnimations(true);</div><div class="line">    &#125;</div><div class="line">    mCanUseHardware = canUseHardware;</div><div class="line"></div><div class="line">    final boolean hasContent;</div><div class="line">    if (canUseHardware &amp;&amp; mHardwareAnimating) &#123;</div><div class="line">        hasContent = drawHardware((HardwareCanvas) c);</div><div class="line">    &#125; else &#123;</div><div class="line">        hasContent = drawSoftware(c, p);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return hasContent;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在以上的函数中 ，会根据当前的Canvas是否打开硬件加速选择执行drawHardware()或者drawSoftware()。<br>这里以drawSoftware()为例看一下水波是怎么绘制的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">private boolean drawSoftware(Canvas c, Paint p) &#123;</div><div class="line">    boolean hasContent = false;</div><div class="line"></div><div class="line">    p.setColor(mColorOpaque);</div><div class="line">    final int alpha = (int) (255 * mOpacity + 0.5f);</div><div class="line">    final float radius = MathUtils.lerp(0, mOuterRadius, mTweenRadius);</div><div class="line">    if (alpha &gt; 0 &amp;&amp; radius &gt; 0) &#123;</div><div class="line">        final float x = MathUtils.lerp(</div><div class="line">                mClampedStartingX - mBounds.exactCenterX(), mOuterX, mTweenX);</div><div class="line">        final float y = MathUtils.lerp(</div><div class="line">                mClampedStartingY - mBounds.exactCenterY(), mOuterY, mTweenY);</div><div class="line">        p.setAlpha(alpha);</div><div class="line">        p.setStyle(Style.FILL);</div><div class="line">        c.drawCircle(x, y, radius, p);</div><div class="line">        hasContent = true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return hasContent;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过以上代码可以看到，”水波“其实就是在给定的Canvas上画一个实心圆，这个圆的透明度，半径，圆心是渐变的而已。<br>以上便是对手指按下时，RippleDrawable绘制逻辑的一个简析。<br>手指移动，抬起，也是相似的一个流程，以后再补充吧~</p>

	
	
	
	
</div>
				
				

                <!-- Post Comments -->
                


            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
</nav>
        </div>
    </div>

				
				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.jpg" alt="Jeepend's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        jeepend@foxmail.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="#" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             主页
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->

	
    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             归档
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2015/02/">二月 2015<span class="sidebar_archives-count">1</span></a>
        </ul>
    </li>

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	
		<li>
			<a href="/links/" title="友情链接">
				友情链接
			</a>
		</li>
	

    <!-- Article Numebr  -->
    <li>
        <a href="/archives">
             文章总数
             <span class="sidebar-badge">1</span>
        </a>
    </li>
</ul>

		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

		<!-- Sidebar Footer -->
		<!-- 
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持。 :) 
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
	<div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		主题 - Material
		<span class="sidebar-badge badge-circle">i</span>
	</div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		sidebar.help
		<span class="mdl-button__ripple-container">
			<span class="mdl-ripple"></span>
		</span>
	</div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

	</div>
    
    <!-- Sidebar Sponsor -->
    


</aside>

				
				
				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				
				
				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
	
	
		<!-- Paradox Footer Left Section -->
		<div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    
    
    <!-- Facebook -->
    
    
    
    <!-- Google + -->
    
    
    
    <!-- Weibo -->
    
    
    
    <!-- Instagram -->
    
    
    
    <!-- Tumblr -->
    
    
    
    <!-- Github -->
    
    <a href="https://github.com/jeepend" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
        <span class="visuallyhidden">Github</span>
    </button></a>
    
</div>


		<!--Copyright-->
		<div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd = new Date();document.write(fd.getFullYear());</script>&nbsp;Jeepend's blog</div>

		<!-- Paradox Footer Right Section -->

		<!-- 
		I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
		It will not impact the appearance and can give developers a lot of support :)

		很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
		它不会影响美观并可以给开发者很大的支持。 :) 
		-->

		<div class="mdl-mini-footer--right-section">
			<div>
				<div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
				<div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
			</div>
		</div>
	
    
</footer>
                
				<!-- Import File -->
<script src="/js/highlight.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>











<!-- Swiftye -->


<!-- Local Search-->


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>

<!-- MathJax Load-->

            </main>
        </div>
		
    </body>
		
	
</html>
